#Load the pfm

#Position count matrix / Position frequency matrix

#PCM <- importMatrix(paste0("../../",representatives$filename[1]))
PCM <- universalmotif::read_matrix(paste0("../../",representatives$filename[1]), headers=FALSE,sep="\t")
PCM@pseudocount=0.01


# MOODS
#--ps p                total pseudocount added to each matrix column in log-
#                        odds conversion (default = 0.01)
# Is this added similarly as below
pseudocount=0.01
#Position probability matrix/Position frequency matrix/Position weight matrix
compute_ppm <- function(C, p) sweep( C + (p/nrow(C))  ,2,(colSums(C) + p),FUN="/")
#(C + (p/ nrow(C)) ) / (colSums(C) + p)
ppm=compute_ppm(pcm, pseudocount)
#[,1]       [,2]       [,3]         [,4]         [,5]       [,6]       [,7]      [,8]
#A 0.09145534 0.09297491 0.72389572 9.577786e-01 3.591949e-07 0.01719602 0.76817973 0.2602977
#C 0.48900966 0.35416172 0.10922802 3.446874e-02 5.891155e-03 0.16104507 0.05473542 0.3429685
#G 0.22135842 0.10491554 0.09813784 7.752273e-03 3.591949e-07 0.05908310 0.12579119 0.2348606
#T 0.19817659 0.44794783 0.06873842 3.460682e-07 9.941081e-01 0.76267580 0.05129366 0.1618732

universalmotif::convert_type(PCM, "PPM")
#N    Y    A    A    T    T    A    N
#A 0.09 0.09 0.72 0.96 0.00 0.02 0.77 0.26
#C 0.49 0.35 0.11 0.03 0.01 0.16 0.05 0.34
#G 0.22 0.10 0.10 0.01 0.00 0.06 0.13 0.23
#T 0.20 0.45 0.07 0.00 0.99 0.76 0.05 0.16

PFM=(pcm2pfm(importMatrix(paste0("../../",representatives$filename[1])))[[1]]) #This is same as ppm except no pseudocount added

#[,1]      [,2]      [,3]      [,4]      [,5]      [,6]      [,7]      [,8]
#A 0.09145523 0.1542689 0.5701286 0.6113683 0.1270231 0.1007315 0.5798643 0.2550357
#C 0.48900982 0.3135027 0.1549049 0.1399569 0.1299208 0.1929642 0.1256979 0.2954626
#G 0.22135840 0.1615485 0.1474132 0.1263163 0.1270231 0.1275885 0.1709308 0.2425966
#T 0.19817655 0.3706799 0.1275532 0.1223585 0.6160329 0.5787158 0.1235070 0.2069051

PSSM=(pcm2pssm(importMatrix(paste0("../../",representatives$filename[1])))[[1]])
#[,1]       [,2]       [,3]       [,4]       [,5]       [,6]       [,7]        [,8]
#A -1.4507941 -0.6964799  1.1893603  1.2901129 -0.9768383 -1.3114060  1.2137865  0.02877281
#C  0.9679359  0.3265512 -0.6905444 -0.8369444 -0.9442935 -0.3735964 -0.9919664  0.24104938
#G -0.1755466 -0.6299563 -0.7620643 -0.9848907 -0.9768383 -0.9704241 -0.5485140 -0.04336638
#T -0.3351386  0.5682462 -0.9708313 -1.0308197  1.3010795  1.2109274 -1.0173353 -0.27295959

universalmotif::convert_type(PCM, "PWM")
#N     Y     A      A      T     T     A     N
#A -1.47 -1.47  1.53   1.94 -13.29 -3.64  1.62  0.06
#C  0.97  0.49 -1.18  -3.06  -4.64 -0.64 -2.32  0.49
#G -0.18 -1.32 -1.32  -4.64 -13.29 -2.06 -0.94 -0.12
#T -0.32  0.88 -1.84 -13.29   1.99  1.60 -2.32 -0.64

#Pseudo-count adjusted log-odds scoring matrix
B=c(0.25, 0.25, 0.25, 0.25)
compute_losm<-function(ppm, B) log2( ppm / B)
losm <- compute_losm(ppm, B)
#[,1]       [,2]      [,3]       [,4]       [,5]       [,6]       [,7]        [,8]
#A -1.4507888 -1.4270147  1.533854   1.937764 -19.408730 -3.8617812  1.6195158  0.05823456
#C  0.9679349  0.5024802 -1.194585  -2.858568  -5.407234 -0.6344636 -2.1913814  0.45614799
#G -0.1755438 -1.2526997 -1.349047  -5.011165 -19.408730 -2.0811106 -0.9908972 -0.09012369
#T -0.3351416  0.8414026 -1.862740 -19.462440   1.991475  1.6091418 -2.2850757 -0.62706367

universalmotif::convert_type(PCM, "PWM", pseudocount = 0.01) #ic 6.78

#N     Y     A      A      T     T     A     N
#A -1.47 -1.47  1.53   1.94 -13.29 -3.64  1.62  0.06
#C  0.97  0.49 -1.18  -3.06  -4.64 -0.64 -2.32  0.49
#G -0.18 -1.32 -1.32  -4.64 -13.29 -2.06 -0.94 -0.12
#T -0.32  0.88 -1.84 -13.29   1.99  1.60 -2.32 -0.64

universalmotif::convert_type(PCM, "ICM", pseudocount = 0.01, nsize_correction = TRUE) #ic 6.78
#N    Y    A    A    T    T    A    N
#A 0.02 0.03 0.52 1.65 0.00 0.02 0.68 0.01
#C 0.12 0.10 0.08 0.06 0.01 0.15 0.05 0.02
#G 0.05 0.03 0.07 0.01 0.00 0.06 0.11 0.01
#T 0.05 0.13 0.05 0.00 1.94 0.71 0.05 0.01

#IC-matrix

compute_entropy <- function(ppm) ppm*log2(ppm)

entropy<- compute_entropy(ppm)

IC_position<- log2(4)+colSums(entropy)

ICM=sweep( ppm ,2,IC_position,FUN="*")
#[,1]       [,2]       [,3]         [,4]         [,5]       [,6]       [,7]        [,8]
#A 0.02152601 0.02703334 0.52079499 1.646003e+00 6.996658e-07 0.01609050 0.67774730 0.012736730
#C 0.11509908 0.10297588 0.07858232 5.923671e-02 1.147522e-02 0.15069157 0.04829180 0.016781927
#G 0.05210153 0.03050519 0.07060368 1.332277e-02 6.996658e-07 0.05528468 0.11098267 0.011492055
#T 0.04664518 0.13024509 0.04945274 5.947401e-07 1.936396e+00 0.71364379 0.04525521 0.007920683

ppm

IC_total=sum(IC_position) #6.77892

sum(getIC(importMatrix(paste0("../../",representatives$filename[1]))[[1]]))

